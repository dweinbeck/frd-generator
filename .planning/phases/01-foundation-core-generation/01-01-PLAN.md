---
phase: 01-foundation-core-generation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - biome.json
  - vitest.config.ts
  - postcss.config.mjs
  - next.config.ts
  - src/app/globals.css
  - src/app/layout.tsx
  - src/types/index.ts
  - src/lib/db/admin.ts
  - src/lib/db/projects.ts
  - src/lib/db/versions.ts
  - src/lib/validation/project.ts
  - src/lib/validation/generation.ts
autonomous: true

must_haves:
  truths:
    - "Next.js 16 project scaffolds, builds, and runs with `npm run dev`"
    - "Biome lints and formats with zero errors on `npm run lint`"
    - "Vitest runs with `npm test` (even if no tests yet, the runner initializes)"
    - "Tailwind v4 CSS-first config produces styled output"
    - "Firebase Admin initializes once per process without 'already initialized' errors"
    - "Project and version Firestore operations (create, get) work against the Firestore subcollection model"
    - "Zod validation schemas reject invalid input with descriptive error messages"
  artifacts:
    - path: "package.json"
      provides: "All Phase 1 dependencies declared"
      contains: "ai, @ai-sdk/google, firebase-admin, react-markdown, zod, vitest, @biomejs/biome"
    - path: "src/types/index.ts"
      provides: "Shared application types for Project, Version, GenerationInput"
      exports: ["Project", "Version", "GenerationInput", "GenerationMode"]
    - path: "src/lib/db/admin.ts"
      provides: "Firebase Admin singleton with getDb() export"
      exports: ["getDb"]
    - path: "src/lib/db/projects.ts"
      provides: "Project CRUD operations against Firestore"
      exports: ["createProject", "getProject", "updateProject"]
    - path: "src/lib/db/versions.ts"
      provides: "Version CRUD operations against Firestore subcollection"
      exports: ["saveVersion", "getLatestVersion"]
    - path: "src/lib/validation/project.ts"
      provides: "Zod schema for project creation input"
      exports: ["CreateProjectSchema"]
    - path: "src/lib/validation/generation.ts"
      provides: "Zod schema for generation request input with size limits"
      exports: ["GenerationRequestSchema"]
  key_links:
    - from: "src/lib/db/projects.ts"
      to: "src/lib/db/admin.ts"
      via: "imports getDb()"
      pattern: "import.*getDb.*from.*admin"
    - from: "src/lib/db/versions.ts"
      to: "src/lib/db/admin.ts"
      via: "imports getDb()"
      pattern: "import.*getDb.*from.*admin"
    - from: "src/lib/db/versions.ts"
      to: "Firestore subcollection"
      via: "projects/{id}/versions/{id} path"
      pattern: "collection.*projects.*collection.*versions"
---

<objective>
Bootstrap the Next.js 16 project with all Phase 1 dependencies, configure tooling (Biome, Vitest, Tailwind v4), and build the Firestore data layer with typed CRUD operations and Zod validation schemas.

Purpose: Establish the foundation that all subsequent plans depend on -- a buildable project with a working data layer and type system.
Output: A scaffolded Next.js 16 app with Firestore data access, shared types, and validation schemas ready for the AI engine and UI.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-core-generation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js 16 project and configure tooling</name>
  <files>
    package.json
    tsconfig.json
    biome.json
    vitest.config.ts
    postcss.config.mjs
    next.config.ts
    src/app/globals.css
    src/app/layout.tsx
  </files>
  <action>
    1. Run `npx create-next-app@latest . --typescript --tailwind --app --src-dir --no-import-alias --turbopack` to scaffold the project in the current directory (frd-generator). If the directory is not empty, handle accordingly (the .planning directory exists -- create-next-app should work with existing files, or scaffold in a temp dir and move files).

    2. Install all Phase 1 dependencies:
    ```bash
    # AI integration
    npm install ai @ai-sdk/google @ai-sdk/react zod

    # Firebase (server-side only)
    npm install firebase-admin server-only

    # Markdown rendering
    npm install react-markdown remark-gfm

    # UI utilities
    npm install @tailwindcss/typography clsx lucide-react nanoid date-fns

    # Dev dependencies
    npm install -D @biomejs/biome vitest @testing-library/react @testing-library/jest-dom @vitejs/plugin-react
    ```

    3. Configure Biome (`biome.json`):
    - Linter enabled with recommended rules
    - Formatter enabled (indent: tab, line width: 100)
    - Organize imports enabled
    - Add scripts to package.json: `"lint": "biome check --write src/"`, `"lint:check": "biome check src/"`

    4. Configure Vitest (`vitest.config.ts`):
    - Use `@vitejs/plugin-react`
    - Set `test.environment` to `jsdom`
    - Set `test.globals` to true
    - Add path alias `@` -> `src`
    - Add script to package.json: `"test": "vitest run"`

    5. Configure Tailwind v4 CSS-first setup:
    - `postcss.config.mjs`: export `{ plugins: { '@tailwindcss/postcss': {} } }`
    - `src/app/globals.css`: Use `@import "tailwindcss"` (v4 syntax). Add `@plugin "@tailwindcss/typography"`. Add custom theme variables under `@theme { }` for primary color (#2563eb), font-sans (Inter, system-ui, sans-serif).

    6. Update `src/app/layout.tsx`:
    - Import globals.css
    - Set metadata: title "FRD Generator", description "Generate Claude Code-ready Functional Requirements Documents from your ideas"
    - Use Inter font from next/font/google
    - Apply font class and antialiased to body
    - Wrap children in a semantic main element with min-h-screen

    7. Remove any ESLint config files that create-next-app may have created (`.eslintrc*`, `eslint.config.*`) since we use Biome instead.

    8. Verify: `npm run build` succeeds, `npm run lint` passes, `npm test` initializes (even with no test files, runner should not crash).
  </action>
  <verify>
    Run `npm run build && npm run lint:check` -- both must exit with code 0. Run `npm test` -- should exit cleanly (no tests found is acceptable, crash is not).
  </verify>
  <done>
    Next.js 16 project builds and lints cleanly. Tailwind v4 CSS-first config is active. Biome and Vitest are configured. All Phase 1 dependencies are installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shared types, Firestore data layer, and validation schemas</name>
  <files>
    src/types/index.ts
    src/lib/db/admin.ts
    src/lib/db/projects.ts
    src/lib/db/versions.ts
    src/lib/validation/project.ts
    src/lib/validation/generation.ts
  </files>
  <action>
    1. Create `src/types/index.ts` with shared TypeScript types:
    - `GenerationMode = 'fast' | 'standard'`
    - `Project` interface: `id: string`, `name: string`, `userId: string` (default 'anonymous' for Phase 1), `mode: GenerationMode`, `latestVersionId: string | null`, `versionCount: number`, `createdAt: Date`, `updatedAt: Date`
    - `Version` interface: `id: string`, `projectId: string`, `versionNumber: number`, `content: string` (rendered markdown), `structuredData: Record<string, unknown>` (raw FRD JSON), `mode: GenerationMode`, `model: string`, `tokensUsed: number`, `metadata: { promptTokens: number, completionTokens: number, generationTimeMs: number }`, `createdAt: Date`
    - `GenerationInput` interface: `projectId: string`, `projectName: string`, `brainDump: string`, `mode: GenerationMode`

    2. Create `src/lib/db/admin.ts` -- Firebase Admin singleton:
    - Import `server-only` at the top (prevents client-side import)
    - Use `getApps().length > 0` guard before `initializeApp()`
    - Parse `FIREBASE_PRIVATE_KEY` env var with `replace(/\\n/g, '\n')` for escaped newlines
    - Export `getDb()` function returning `Firestore` instance
    - Use module-level variables for app and db singletons

    3. Create `src/lib/db/projects.ts` -- Project CRUD:
    - Import `server-only`
    - `createProject(data: { name: string, mode: GenerationMode })`: generates nanoid, writes to `projects/{id}`, sets `userId: 'anonymous'` (Phase 1 stub -- add `// TODO: Replace with authenticated userId` comment), sets `latestVersionId: null`, `versionCount: 0`, uses `FieldValue.serverTimestamp()` for createdAt/updatedAt. Returns `{ id }`.
    - `getProject(projectId: string)`: reads `projects/{id}`, returns Project or null
    - `updateProject(projectId: string, data: Partial<Pick<Project, 'latestVersionId' | 'versionCount'>>)`: updates specific fields + updatedAt timestamp

    4. Create `src/lib/db/versions.ts` -- Version CRUD with subcollection:
    - Import `server-only`
    - `saveVersion(projectId: string, data: VersionData)`: generates nanoid, writes to `projects/{projectId}/versions/{id}` subcollection, uses `FieldValue.serverTimestamp()` for createdAt. Returns `{ id }`.
    - `getLatestVersion(projectId: string)`: queries versions subcollection ordered by `createdAt desc`, limit 1. Returns version data or null.
    - Note the subcollection path `projects/{id}/versions/{id}` to avoid the 1 MiB document limit.

    5. Create `src/lib/validation/project.ts`:
    - `CreateProjectSchema`: `z.object({ name: z.string().min(1, 'Project name is required').max(100, 'Project name must be 100 characters or fewer'), mode: z.enum(['fast', 'standard']) })`

    6. Create `src/lib/validation/generation.ts`:
    - `GenerationRequestSchema`: `z.object({ projectId: z.string().min(1), projectName: z.string().min(1).max(100), brainDump: z.string().min(50, 'Please provide at least 50 characters to generate a meaningful FRD').max(15000, 'Input exceeds maximum length of 15,000 characters'), mode: z.literal('fast') })`
    - Export the inferred type: `GenerationRequest`

    7. Verify: `npm run build` succeeds (type-checks all files). `npm run lint` passes.
  </action>
  <verify>
    Run `npm run build && npm run lint:check` -- both must exit 0. Confirm no `any` types in the created files (grep for `: any` should return zero matches in these files).
  </verify>
  <done>
    Shared types, Firebase Admin singleton, project CRUD, version CRUD (subcollection model), and Zod validation schemas all exist, type-check, and lint cleanly. The `userId: 'anonymous'` stub is in place with TODO comment for Phase 4.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` exits 0 (project compiles, all TypeScript resolves)
2. `npm run lint:check` exits 0 (Biome finds no issues)
3. `npm test` runs without crashing (Vitest initializes)
4. `grep -r "server-only" src/lib/db/` confirms all DB files import server-only
5. `grep -r "getApps" src/lib/db/admin.ts` confirms singleton guard exists
6. `grep -r "anonymous" src/lib/db/projects.ts` confirms Phase 1 userId stub
7. All files in files_modified list exist on disk
</verification>

<success_criteria>
- The project builds, lints, and the test runner initializes without errors
- All Phase 1 npm dependencies are installed
- Firestore data layer uses subcollection model (projects/{id}/versions/{id})
- Firebase Admin uses singleton pattern with getApps() guard
- All server-side modules import 'server-only'
- Zod schemas enforce input constraints (name length, brain dump min/max length)
- No `any` types in created files
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-generation/01-01-SUMMARY.md`
</output>
