---
phase: 01-foundation-core-generation
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/app/page.tsx
  - src/app/projects/[projectId]/page.tsx
  - src/components/generation/mode-selector.tsx
  - src/components/generation/brain-dump-input.tsx
  - src/components/generation/generation-progress.tsx
  - src/components/generation/frd-display.tsx
  - src/components/generation/generation-flow.tsx
  - src/components/export/copy-button.tsx
  - src/components/export/download-button.tsx
  - src/hooks/use-copy-to-clipboard.ts
autonomous: false

must_haves:
  truths:
    - "User can enter a project name on the home page and create a new project"
    - "User sees Fast mode and Standard mode options with descriptions and time estimates"
    - "User can type a freeform brain dump (minimum 50 chars, maximum 15,000 chars) and submit it"
    - "User sees a progress indicator while the FRD generates (app remains responsive during generation)"
    - "Generated FRD displays as formatted Markdown with proper headings, lists, and tables"
    - "User can copy the FRD Markdown to clipboard with one click and sees confirmation feedback"
    - "User can download the FRD as a .md file named after the project"
    - "The app is mobile responsive -- layout adapts from mobile to desktop breakpoints"
    - "All form inputs have labels and are keyboard navigable"
  artifacts:
    - path: "src/app/page.tsx"
      provides: "Home page with project creation form (name + mode selector)"
      contains: "CreateProjectSchema"
    - path: "src/app/projects/[projectId]/page.tsx"
      provides: "Project page with generation flow"
      contains: "GenerationFlow"
    - path: "src/components/generation/mode-selector.tsx"
      provides: "Fast vs Standard mode selection cards with descriptions"
      exports: ["ModeSelector"]
    - path: "src/components/generation/brain-dump-input.tsx"
      provides: "Textarea for brain dump with character count and validation"
      exports: ["BrainDumpInput"]
    - path: "src/components/generation/generation-progress.tsx"
      provides: "Progress indicator shown during FRD generation"
      exports: ["GenerationProgress"]
    - path: "src/components/generation/frd-display.tsx"
      provides: "Rendered FRD markdown with export buttons"
      exports: ["FrdDisplay"]
    - path: "src/components/generation/generation-flow.tsx"
      provides: "State machine orchestrating input -> generating -> complete flow"
      exports: ["GenerationFlow"]
    - path: "src/components/export/copy-button.tsx"
      provides: "Copy-to-clipboard button with feedback"
      exports: ["CopyButton"]
    - path: "src/components/export/download-button.tsx"
      provides: "Download as .md file button"
      exports: ["DownloadButton"]
    - path: "src/hooks/use-copy-to-clipboard.ts"
      provides: "Custom hook wrapping navigator.clipboard.writeText"
      exports: ["useCopyToClipboard"]
  key_links:
    - from: "src/app/page.tsx"
      to: "/api/projects"
      via: "fetch POST to create project, then redirect to /projects/[id]"
      pattern: "fetch.*api/projects"
    - from: "src/components/generation/generation-flow.tsx"
      to: "/api/generate"
      via: "fetch POST with brain dump, receives FRD markdown"
      pattern: "fetch.*api/generate"
    - from: "src/components/generation/frd-display.tsx"
      to: "react-markdown"
      via: "renders markdown string as formatted React components"
      pattern: "ReactMarkdown"
    - from: "src/components/export/copy-button.tsx"
      to: "src/hooks/use-copy-to-clipboard.ts"
      via: "uses useCopyToClipboard hook"
      pattern: "useCopyToClipboard"
    - from: "src/components/export/download-button.tsx"
      to: "Blob API"
      via: "creates Blob from markdown string and triggers download"
      pattern: "new Blob.*createObjectURL"
---

<objective>
Build the complete user-facing UI: project creation, mode selection, brain dump input, generation progress, FRD display with markdown rendering, clipboard copy, file download, mobile responsiveness, and keyboard accessibility.

Purpose: This is the user's entire experience -- from entering a project name to holding a generated FRD. It wires the UI to the API routes built in Plan 02 and delivers the copy/download export features.
Output: A fully functional, mobile-responsive web app where a user can create a project, enter a brain dump, generate an FRD, and export it.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-core-generation/01-RESEARCH.md
@.planning/phases/01-foundation-core-generation/01-01-SUMMARY.md
@.planning/phases/01-foundation-core-generation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build project creation page, generation flow, and all generation components</name>
  <files>
    src/app/page.tsx
    src/app/projects/[projectId]/page.tsx
    src/components/generation/mode-selector.tsx
    src/components/generation/brain-dump-input.tsx
    src/components/generation/generation-progress.tsx
    src/components/generation/frd-display.tsx
    src/components/generation/generation-flow.tsx
    src/components/export/copy-button.tsx
    src/components/export/download-button.tsx
    src/hooks/use-copy-to-clipboard.ts
  </files>
  <action>
    1. Create `src/hooks/use-copy-to-clipboard.ts`:
    - `'use client'` directive
    - Export `useCopyToClipboard()` hook that returns `{ isCopied: boolean, copy: (text: string) => Promise<boolean> }`
    - On copy: call `navigator.clipboard.writeText(text)`, set `isCopied` to true, reset after 2000ms via setTimeout
    - Handle missing clipboard API gracefully (return false)

    2. Create `src/components/export/copy-button.tsx`:
    - `'use client'` directive
    - Props: `text: string` (the markdown to copy)
    - Uses `useCopyToClipboard` hook
    - Renders a button with clipboard icon (from lucide-react: `Copy` / `Check`)
    - Shows "Copy Markdown" text, changes to "Copied!" with check icon for 2 seconds after copy
    - Accessible: `aria-label="Copy FRD markdown to clipboard"`

    3. Create `src/components/export/download-button.tsx`:
    - `'use client'` directive
    - Props: `content: string`, `filename: string`
    - On click: creates `new Blob([content], { type: 'text/markdown;charset=utf-8' })`, creates object URL, creates hidden `<a>` element with `download` attribute, clicks it, revokes URL
    - Renders button with download icon (lucide-react: `Download`)
    - Shows "Download .md"
    - Accessible: `aria-label="Download FRD as markdown file"`

    4. Create `src/components/generation/mode-selector.tsx`:
    - `'use client'` directive
    - Props: `value: GenerationMode`, `onChange: (mode: GenerationMode) => void`
    - Renders two selectable cards side by side (stacked on mobile):
      - **Fast Mode**: title "Fast Mode", description "Paste your brain dump and get an FRD in seconds", time estimate "~10 seconds", icon (lucide-react: `Zap`)
      - **Standard Mode**: title "Standard Mode", description "Guided questions to build a comprehensive FRD", time estimate "~5 minutes", icon (lucide-react: `ClipboardList`), badge/note "Coming in Phase 2" (disabled in Phase 1)
    - Selected card has a highlighted border/ring
    - Standard mode card is visually disabled (opacity-50, cursor-not-allowed) with a "Coming Soon" badge
    - Keyboard accessible: arrow keys or tab to switch, enter/space to select
    - Each card has role="radio" with proper aria attributes, wrapped in a role="radiogroup"

    5. Create `src/components/generation/brain-dump-input.tsx`:
    - `'use client'` directive
    - Props: `onSubmit: (brainDump: string) => void`, `error?: string`, `maxLength: number`, `isSubmitting: boolean`
    - Renders a `<label>` ("Describe your project idea") + `<textarea>` with placeholder text guiding the user (e.g., "Tell us about your project idea. What problem does it solve? Who uses it? What are the key features?...")
    - Shows character count: `{current}/{maxLength}` below the textarea
    - Shows min length hint: "Minimum 50 characters" when under 50 chars
    - Submit button: "Generate FRD" -- disabled when text < 50 chars or > maxLength or isSubmitting
    - If `error` prop is set, shows error message in red below the input
    - Textarea auto-focuses on mount
    - Accessible: textarea has id linked to label, error message has role="alert"

    6. Create `src/components/generation/generation-progress.tsx`:
    - `'use client'` directive
    - Shows an animated progress indicator during generation:
      - A pulsing/animated icon or spinner
      - Text: "Generating your FRD..." with cycling status messages (e.g., "Analyzing your input...", "Identifying requirements...", "Structuring document...", "Finalizing FRD...") that rotate every 3-4 seconds
    - Use CSS animations (Tailwind animate-pulse or custom keyframes) -- no external animation library
    - The component is purely visual -- no logic, just UI feedback

    7. Create `src/components/generation/frd-display.tsx`:
    - `'use client'` directive
    - Props: `markdown: string`, `projectName: string`
    - Renders:
      - Export action bar at top: CopyButton + DownloadButton side by side (stacked on mobile)
      - The rendered FRD using `<ReactMarkdown remarkPlugins={[remarkGfm]}>{markdown}</ReactMarkdown>` inside an `<article>` with Tailwind `prose` classes from @tailwindcss/typography
      - Responsive prose sizing: `prose-sm` on mobile, `prose-base` on tablet, `prose-lg` on desktop
    - Download filename: `{projectName-slugified}-frd.md`

    8. Create `src/components/generation/generation-flow.tsx`:
    - `'use client'` directive
    - Props: `projectId: string`, `projectName: string`
    - Internal state machine with states: `'input' | 'generating' | 'complete' | 'error'`
    - State `input`: renders `<BrainDumpInput>` with `onSubmit` handler
    - On submit: transitions to `generating`, calls `fetch('/api/generate', { method: 'POST', body: JSON.stringify({ projectId, projectName, brainDump, mode: 'fast' }) })`
    - State `generating`: renders `<GenerationProgress />`
    - On success: transitions to `complete`, stores markdown and structuredData in state
    - State `complete`: renders `<FrdDisplay markdown={markdown} projectName={projectName} />` with a "Generate Another" button to reset to `input` state
    - State `error`: renders `<BrainDumpInput>` with the error message displayed, user can retry
    - Handle non-ok responses: parse error from JSON body, display to user

    9. Create `src/app/page.tsx` -- Home / Project creation page:
    - This is a client component (`'use client'`)
    - Renders a centered card layout with:
      - App title: "FRD Generator" with subtitle "Generate Claude Code-ready Functional Requirements Documents from your ideas"
      - Project name input with label "Project Name"
      - `<ModeSelector>` component for mode selection (default: 'fast')
      - "Create Project" submit button
    - On submit:
      - Validate project name is not empty
      - Call `fetch('/api/projects', { method: 'POST', body: JSON.stringify({ name, mode }) })`
      - On success (201): redirect to `/projects/{projectId}` using `useRouter().push()`
      - On error: show error message
    - Layout: max-w-2xl, centered, with adequate padding on all screen sizes

    10. Create `src/app/projects/[projectId]/page.tsx` -- Project detail page:
    - Server component that fetches project data and renders the client-side GenerationFlow
    - On mount: fetch project via internal API or direct Firestore call (server component can call db directly)
    - If project not found: render 404-style message
    - If project has a latestVersion with content: render `<FrdDisplay>` with the existing FRD
    - If no version yet: render `<GenerationFlow projectId={projectId} projectName={project.name} />`
    - Include a "Back to Home" link
    - Mobile-friendly layout with proper padding

    11. Apply responsive design throughout ALL components:
    - Use Tailwind responsive prefixes: `sm:`, `md:`, `lg:`
    - Stack elements vertically on mobile, horizontally on desktop
    - Adequate touch targets (min 44px) on mobile
    - Text sizing: smaller on mobile, larger on desktop
    - Padding/margins: tighter on mobile, more spacious on desktop

    12. Apply accessibility throughout ALL components:
    - All form inputs have associated `<label>` elements (via htmlFor/id)
    - All buttons have descriptive text or aria-label
    - Error messages use role="alert"
    - Focus styles visible (don't remove outlines -- use Tailwind focus-visible:ring)
    - Logical tab order (no positive tabIndex values)
    - Color contrast: sufficient contrast ratios for text/backgrounds

    13. Verify: `npm run build` succeeds. `npm run lint` passes.
  </action>
  <verify>
    Run `npm run build && npm run lint:check` -- both must exit 0. Verify all component files exist: `ls src/components/generation/ src/components/export/ src/hooks/`. Verify pages exist: `ls src/app/page.tsx src/app/projects/*/page.tsx`.
  </verify>
  <done>
    Complete UI exists: home page with project creation, project page with generation flow (brain dump -> progress -> FRD display), copy-to-clipboard and download-as-file export buttons, mode selector (Fast active, Standard disabled), all with responsive design and keyboard accessibility. App builds and lints cleanly.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end verification of the full brain dump to FRD pipeline</name>
  <files>
    (no files modified -- verification only)
  </files>
  <action>
    Human verifies the complete Phase 1 FRD Generator end-to-end. The following was built:
    - Home page with project creation (name + mode selector)
    - Generation flow: brain dump input -> progress indicator -> rendered FRD display
    - Export: copy-to-clipboard and download-as-.md-file
    - Mobile responsive layout with keyboard accessibility

    Prerequisites: Ensure `GOOGLE_GENERATIVE_AI_API_KEY` is set in `.env.local` and Firebase credentials (`FIREBASE_PROJECT_ID`, `FIREBASE_CLIENT_EMAIL`, `FIREBASE_PRIVATE_KEY`) are configured.

    Verification steps:

    1. Start the dev server: `npm run dev`
    2. Open http://localhost:3000 in a browser

    **Project Creation:**
    3. Verify the home page shows "FRD Generator" title, a project name input, and mode selector
    4. Verify the Fast mode card is selectable and Standard mode card shows "Coming Soon" and is disabled
    5. Enter a project name (e.g., "Task Manager App") and click "Create Project"
    6. Verify you are redirected to /projects/[projectId]

    **Brain Dump and Generation:**
    7. Verify the brain dump textarea appears with a label and placeholder text
    8. Type fewer than 50 characters -- verify the submit button is disabled and a hint shows "Minimum 50 characters"
    9. Enter a substantial brain dump (100+ characters describing a project idea)
    10. Verify the character count updates as you type
    11. Click "Generate FRD"
    12. Verify a progress indicator appears with cycling status messages
    13. Wait for generation to complete (typically 5-15 seconds)
    14. Verify a formatted FRD appears with proper headings, sections, bullet points

    **FRD Quality:**
    15. Verify the FRD has these sections: project name heading, core value, overview, personas with goals, categorized requirements with IDs and priorities, acceptance criteria as checkboxes, constraints, out of scope items, and open questions
    16. Verify all requirement IDs follow the REQ-XX pattern

    **Export:**
    17. Click the "Copy Markdown" button -- verify it changes to "Copied!" temporarily
    18. Paste in a text editor -- verify the pasted content is valid markdown
    19. Click the "Download .md" button -- verify a file downloads with the project name in the filename
    20. Open the downloaded file -- verify it contains the same markdown

    **Responsiveness:**
    21. Resize the browser to mobile width (less than 640px) -- verify the layout adapts (cards stack, text resizes, no horizontal scrolling)
    22. Verify the brain dump textarea is usable on mobile width
    23. Tab through the page -- verify all interactive elements are reachable and focused states are visible

    **Error Handling:**
    24. Try creating a project with an empty name -- verify an error message appears
    25. Verify the app remains usable after an error (can retry)
  </action>
  <verify>
    All 25 verification steps above pass. The full flow works end-to-end: create project -> brain dump -> generate FRD -> view rendered markdown -> copy to clipboard -> download as file. App is responsive and keyboard accessible.
  </verify>
  <done>
    Human has confirmed Phase 1 works end-to-end by typing "approved". All success criteria for Phase 1 are met.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` exits 0
2. `npm run lint:check` exits 0
3. Home page renders with project creation form and mode selector
4. Project page renders with brain dump input or existing FRD
5. Brain dump enforces min 50 / max 15,000 character limits in the UI
6. Progress indicator appears during generation
7. Generated FRD renders as formatted markdown with all expected sections
8. Copy button copies markdown to clipboard with visual feedback
9. Download button downloads a .md file named after the project
10. Layout is responsive -- usable on mobile, tablet, and desktop widths
11. All form inputs have labels, all buttons have text or aria-labels
12. Tab/keyboard navigation works through the entire flow
</verification>

<success_criteria>
- A user can complete the full flow: enter project name -> select Fast mode -> type brain dump -> generate FRD -> see rendered markdown -> copy to clipboard -> download as .md file
- The app is mobile responsive (no horizontal scrolling at any viewport width)
- All interactive elements are keyboard accessible
- Form inputs have labels and error states have role="alert"
- The generated FRD is structurally consistent with clear sections, requirement IDs, and acceptance criteria
- Human verification confirms the end-to-end flow works correctly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-generation/01-03-SUMMARY.md`
</output>
